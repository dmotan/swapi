<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>SWAPI</title>
    <!-- <link rel="stylesheet" type="text/css" href="style.css"> -->
    <style>
        #header {
            background-image: linear-gradient(#323A40, #2894E6);
            width: 100%;
            height: 70px;
            text-align: center;
            color: #fff;
            padding: 50px 0;
        }

        #wrapper {
            width: 100%;
            margin: auto;
            background: #000;
        }

        .char-list {
            border: 2px solid #000;
            padding: 10px;
            float: left;
            margin: 10px;
            color: #fff;
            background: #323A40;
            width: 28%;
            height: auto;
        }

        .vehicle-div {
            border: 1px solid #2894E6;
            padding: 10px;
            margin-top: 10px;
            color: #fff;
            background: #323A40;

        }

        .vehicles-btn {
            display: block;
            background: #2894E6;
            padding: 10px;
            color: #323A40;
            width: 50%;
            margin: 5px 0 15px 0;
            font-weight: bold;
            /* margin: auto; */
        }
    </style>
</head>

<body>
    <div id="header">
        <h1>STAR WARS</h1>
    </div>
    <div id="wrapper"></div>
</body>


<script>
    
    const queryURL = "https://swapi.co/api/people";
   
    fetch('https://swapi.co/api/people')
        .then(function (response) {
            return response.json();
        })
        .then(function (response) {
            // console.log(response);
            const characters = response.results;
            let name, height, mass, skin_color, gender, vehicles;

            var newList = document.createElement("ul");

            for (let i = 0; i < characters.length; i++) {
                name = characters[i].name;
                height = characters[i].height;
                mass = characters[i].mass;
                skin_color = characters[i].skin_color;
                gender = characters[i].gender;
                vehicles = characters[i].vehicles;

                var newListItem = document.createElement("li");
                newListItem.id = i;
                newListItem.className = "char-list";

                if (vehicles.length >= 1) {
                    newListItem.setAttribute("data-vehicles", vehicles);
                } else {
                    newListItem.setAttribute("data-vehicles", "none");
                }

                newListItem.innerHTML =
                    `
                    <p>Name: ${name}</p>
                    <p>Height: ${height}</p>
                    <p>Mass: ${mass}</p>
                    <p>Skin Color:  ${skin_color} </p>
                    <p>Gender: ${gender}</p>
                    <p>Number of Vehicles: ${vehicles.length}</p>
                    <button id="btn-${i}" class="vehicles-btn" data-clicked="unclicked">Show Vehicles</button>`;

                newList.appendChild(newListItem);
            }
            document.querySelector('#wrapper').appendChild(newList);

            var classname = document.getElementsByClassName("vehicles-btn");

            Array.from(classname).forEach(function (element) {
                element.addEventListener('click', myFunction);
            });

            function myFunction() {

                //reference for the list item that contais the clicked button
                const listItem = this.parentNode;
                
                //creating a new div for vehicles
                var vehiclesDiv = document.createElement('div');
                vehiclesDiv.id = "vehiclesDiv";
                
                //check if the button is clicked already or not!, if no proceed and get the data. 
                //Otherwise it means that it is clicked so we go to else to hide it
                this.setAttribute("data-clicked", "clicked");

                //splitting the vehicles string to get the vehicle's urls
                let availableVehicles = listItem.getAttribute("data-vehicles").split(',');

                //check if this character has vehicles or not
                if (availableVehicles != 'none') {
                    for (var i = 0; i < availableVehicles.length; i++) {

                        //fetching data from the api
                        fetch(availableVehicles[i])
                            .then(function (response) {
                                return response.json();
                            })
                            .then(function (response) {

                                //creating a new div for the new vehicle
                                var newVehicle = document.createElement('div');
                                newVehicle.className = "vehicle-div";

                                //destructureing response object.
                                var {
                                    name: vname,
                                    cargo_capacity: vcapacity,
                                    length: vlength,
                                    model: vmodel,
                                    vehicle_class: vclass
                                } = response;

                                //creating and formatting the vehicle's data
                                newVehicle.innerHTML =
                                    `<p>Vehicle Name: ${vname}</p>
                                    <p>Cargo Capacity: ${vcapacity}</p>
                                    <p>Vehicle Length: ${vlength}</p>
                                    <p>Vehicle Model: ${vmodel}</p>
                                    <p>Vehicle Class: ${vclass}</p>`;

                                //appending the new vehicle to the vehicles div (the wrapper)
                                vehiclesDiv.appendChild(newVehicle);

                            });

                        //appending the vehicles div to the list item(character div)  
                        listItem.appendChild(vehiclesDiv);
                    }
                    // var hideButton = document.createElement("button");
                    // hideButton.className = "vehicles-btn";
                    // hideButton.innerHTML = "Hide Vehicles";
                    // vehiclesDiv.appendChild(hideButton);
                    this.innerHTML = "Hide Vehicles";

                    // console.log(this);
                    this.addEventListener('click', hideFunction);
                //    this.setAttribute("data-clicked", "clicked");

                } else {
                    alert("This Character has no Vechicles!!!");

                }
                document.getElementById('vehiclesDiv').style.display = 'block';

                return
            }

            function hideFunction(){
                console.log(this);
                document.getElementById('vehiclesDiv').style.display = 'none';
                this.innerHTML = "Show Vehicles";
                return;

            }
        });
</script>

</html>